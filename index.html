<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ì–´ ë§ì”€ ë¬µìƒ í”Œë ˆì´ì–´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f8;
      color: #222;
    }
    .app {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 1.4rem;
    }
    .hint {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 12px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }
    select, input[type="text"], button {
      font: inherit;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: white;
    }
    button {
      cursor: pointer;
      border: 1px solid #bbb;
    }
    button:hover {
      background: #eee;
    }
    button.primary {
      background: #2f7cf6;
      color: white;
      border-color: #2f7cf6;
    }
    button.primary:hover {
      background: #225ec0;
    }
    .search-box {
      margin: 8px 0 12px;
      display: flex;
      gap: 8px;
    }
    .search-box input {
      flex: 1;
    }
    .now-playing {
      margin: 6px 0 10px;
      padding: 8px 10px;
      border-radius: 8px;
      background: #fff;
      border-left: 4px solid #2f7cf6;
      font-size: 0.9rem;
    }
    .now-playing-title {
      font-weight: 600;
    }
    .list {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #ddd;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    thead {
      background: #f0f0f5;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    th, td {
      padding: 8px 6px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th:nth-child(1), td:nth-child(1) {
      width: 32px;
      text-align: center;
    }
    th:nth-child(4), td:nth-child(4) {
      width: 70px;
      text-align: center;
    }
    tr.active {
      background: #e8f1ff;
    }
    tr:hover {
      background: #f7f7fc;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: #eee;
      margin-left: 4px;
    }
    .mode-label {
      font-size: 0.85rem;
    }

    /* íŒì—… ê³µí†µ */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 50;
    }
    .overlay.visible {
      display: flex;
    }
    .popup {
      max-width: 640px;
      width: 100%;
      background: #ffffff;
      border-radius: 16px;
      padding: 18px 16px;
      box-shadow: 0 14px 40px rgba(0,0,0,0.25);
    }
    .popup-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #666;
      margin-bottom: 6px;
    }
    .popup-body {
      font-size: 1.05rem;
      line-height: 1.5;
      white-space: pre-wrap;
    }
    .popup-hint {
      margin-top: 10px;
      font-size: 0.8rem;
      color: #888;
      text-align: right;
    }

    @media (max-width: 600px) {
      th:nth-child(3), td:nth-child(3) {
        display: none; /* ëª¨ë°”ì¼ì—ì„œ í•œêµ­ì–´ ì˜ë¯¸ ì»¬ëŸ¼ ìˆ¨ê¸°ê¸° (íŒì—…ìœ¼ë¡œ ë³´ê¸°) */
      }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <h1>ì˜ì–´ ë§ì”€ ë¬µìƒ í”Œë ˆì´ì–´</h1>
    <div class="hint">
      ğŸ§ ì¬ìƒëª¨ë“œ: 1=ì¼ë°˜ / 2=í•œ ê³¡ ë°˜ë³µ / 3=ì¬ìƒ í›„ ë‹¤ìŒ ê³¡(ìˆ˜ë™ ì¬ìƒ) / 4=ì—°ì† ìë™ì¬ìƒ<br>
      âŒ¨ í‚¤ë³´ë“œ: <b>S</b> = ë¬¸ì¥ íŒì—…, <b>M</b> = ì˜ë¯¸ íŒì—…<br>
      ğŸ“± ëª¨ë°”ì¼: <b>ìœ„ë¡œ ìŠ¤ì™€ì´í”„</b> = ë¬¸ì¥ / <b>ì•„ë˜ë¡œ ìŠ¤ì™€ì´í”„</b> = ì˜ë¯¸ (íŒì—… í„°ì¹˜ ì‹œ ë‹«í˜)
    </div>

    <div class="controls">
      <label class="mode-label">
        ì¬ìƒ ëª¨ë“œ:
        <select id="modeSelect">
          <option value="1">1. ì¼ë°˜ ì¬ìƒ (ëë‚˜ë©´ ë©ˆì¶¤)</option>
          <option value="2">2. ë°˜ë³µ ì¬ìƒ (í˜„ì¬ ê³¡ ë°˜ë³µ)</option>
          <option value="3">3. ì¬ìƒ í›„ ë‹¤ìŒ ê³¡ìœ¼ë¡œ (ìë™ ì´ë™ë§Œ)</option>
          <option value="4">4. ìë™ ì—°ì†ì¬ìƒ (í”Œë ˆì´ë¦¬ìŠ¤íŠ¸)</option>
        </select>
      </label>

      <button id="prevBtn">â® ì´ì „</button>
      <button id="playPauseBtn" class="primary">â–¶ ì¬ìƒ</button>
      <button id="nextBtn">â­ ë‹¤ìŒ</button>

      <button id="shuffleBtn">ğŸ”€ ì „ì²´ ëœë¤</button>
      <button id="resetOrderBtn">â†º ìˆœì°¨ ì¬ìƒ(ì´ˆê¸°í™”)</button>
    </div>

    <div class="search-box">
      <input id="searchInput" type="text" placeholder="ì˜ì–´ ë˜ëŠ” í•œê¸€ë¡œ ê²€ìƒ‰..." />
      <button id="clearSearchBtn">ì§€ìš°ê¸°</button>
    </div>

    <div class="now-playing" id="nowPlaying">
      <div><span class="now-playing-label">í˜„ì¬ ì„ íƒ:</span></div>
      <div class="now-playing-title" id="npTitle">ì•„ì§ ì„ íƒëœ íŠ¸ë™ì´ ì—†ìŠµë‹ˆë‹¤.</div>
      <div id="npSubtitle" style="font-size:0.8rem;color:#666;"></div>
    </div>

    <div class="list">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>ì˜ì–´ ë¬¸ì¥</th>
            <th>ëœ»(ìš”ì•½)</th>
            <th>ì¬ìƒ</th>
          </tr>
        </thead>
        <tbody id="trackTbody">
          <!-- JSì—ì„œ ì±„ì›€ -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- ë¬¸ì¥ íŒì—… -->
  <div class="overlay" id="sentenceOverlay">
    <div class="popup">
      <div class="popup-title">ì˜ì–´ ë¬¸ì¥</div>
      <div class="popup-body" id="sentenceBody"></div>
      <div class="popup-hint">íƒ­(í´ë¦­)í•˜ë©´ ë‹«í™ë‹ˆë‹¤</div>
    </div>
  </div>

  <!-- ì˜ë¯¸ íŒì—… -->
  <div class="overlay" id="meaningOverlay">
    <div class="popup">
      <div class="popup-title">ì˜ë¯¸ (í•œêµ­ì–´)</div>
      <div class="popup-body" id="meaningBody"></div>
      <div class="popup-hint">íƒ­(í´ë¦­)í•˜ë©´ ë‹«í™ë‹ˆë‹¤</div>
    </div>
  </div>

  <script>
    // === ë°ì´í„° ì •ì˜ ===
    const tracks = [
      {
        id: 1,
        text: "Role of the Holy Spirit",
        meaning: "ì„±ë ¹ì˜ ì—­í• ",
        src: "https://github.com/cocodeKang/mp3/blob/main/Role%2Bof%2Bthe%2BHoly%2BSpirit_.mp3?raw=1"
      },
      {
        id: 2,
        text: "The Holy Spirit plays a crucial role in guiding believers through the process of self-reflection.",
        meaning: "ì„±ë ¹ì€ ì‹ ìê°€ ìê¸° ìì‹ ì„ ëŒì•„ë³´ê³  ì ê²€í•˜ë„ë¡ ì¸ë„í•˜ëŠ” ë§¤ìš° ì¤‘ìš”í•œ ì—­í• ì„ í•˜ì‹ ë‹¤.",
        src: "https://github.com/cocodeKang/mp3/blob/main/The%2BHoly%2BSpirit%2Bplays%2Ba%2Bcrucial%2Brole%2Bin%2Bguiding%2Bbe.mp3?raw=1"
      },
      {
        id: 3,
        text: 'John 16:13 states, "But when He, the Spirit of truth, comes, He will guide you into all truth." .',
        meaning: "ìš”í•œë³µìŒ 16:13 â€” ì§„ë¦¬ì˜ ì˜ì´ì‹  ì„±ë ¹ê»˜ì„œ ì˜¤ì‹œë©´ ì‹ ìë“¤ì„ ëª¨ë“  ì§„ë¦¬ ê°€ìš´ë°ë¡œ ì¸ë„í•˜ì‹ ë‹¤.",
        src: "https://github.com/cocodeKang/mp3/blob/main/John%2B16_13%2Bstates%252C%2B_But%2Bwhen%2BHe%252C%2Bthe%2BSpirit%2Bof%2Btru.mp3?raw=1"
      },
      {
        id: 4,
        text: "The Spirit convicts, teaches, and reveals areas in need of growth, helping believers to conform to the image of Christ.",
        meaning: "ì„±ë ¹ì€ ì£„ë¥¼ ê¹¨ë‹«ê²Œ í•˜ì‹œê³ , ê°€ë¥´ì¹˜ì‹œë©°, ì„±ì¥í•´ì•¼ í•  ë¶€ë¶„ì„ ë³´ì—¬ ì£¼ì…”ì„œ ì‹ ìë“¤ì´ ê·¸ë¦¬ìŠ¤ë„ì˜ ëª¨ìŠµìœ¼ë¡œ ë³€í™”ë˜ë„ë¡ ë•ëŠ”ë‹¤.",
        src: "https://github.com/cocodeKang/mp3/blob/main/The%2BSpirit%2Bconvicts%252C%2Bteaches%252C%2Band%2Breveals%2Bareas%2Bin.mp3?raw=1"
      }
    ];

    // ì¬ìƒ ìˆœì„œ ê´€ë¦¬ìš©: í•­ìƒ "tracks ë°°ì—´ì˜ ì¸ë±ìŠ¤"ë¥¼ ë‹´ìŒ
    let order = tracks.map((_, i) => i);
    let currentPos = 0; // order ë°°ì—´ ì•ˆì—ì„œì˜ ìœ„ì¹˜
    let currentMode = 1; // 1~4
    const audio = new Audio();
    let isPlaying = false;

    // DOM
    const modeSelect = document.getElementById("modeSelect");
    const prevBtn = document.getElementById("prevBtn");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const nextBtn = document.getElementById("nextBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const resetOrderBtn = document.getElementById("resetOrderBtn");
    const searchInput = document.getElementById("searchInput");
    const clearSearchBtn = document.getElementById("clearSearchBtn");
    const trackTbody = document.getElementById("trackTbody");
    const npTitle = document.getElementById("npTitle");
    const npSubtitle = document.getElementById("npSubtitle");
    const sentenceOverlay = document.getElementById("sentenceOverlay");
    const meaningOverlay = document.getElementById("meaningOverlay");
    const sentenceBody = document.getElementById("sentenceBody");
    const meaningBody = document.getElementById("meaningBody");

    // === ìœ í‹¸ ===
    function getCurrentTrackIndex() {
      return order[currentPos] ?? 0;
    }
    function getCurrentTrack() {
      return tracks[getCurrentTrackIndex()];
    }

    function renderList() {
      const q = searchInput.value.trim().toLowerCase();
      trackTbody.innerHTML = "";
      order.forEach((trackIdx, pos) => {
        const t = tracks[trackIdx];
        const en = t.text.toLowerCase();
        const ko = t.meaning.toLowerCase();

        if (q && !en.includes(q) && !ko.includes(q)) {
          return; // ê²€ìƒ‰ì— ì•ˆ ê±¸ë¦¬ë©´ ìˆ¨ê¹€
        }

        const tr = document.createElement("tr");
        if (pos === currentPos) {
          tr.classList.add("active");
        }
        tr.dataset.pos = String(pos);

        const tdNum = document.createElement("td");
        tdNum.textContent = String(pos + 1);

        const tdEn = document.createElement("td");
        tdEn.textContent = t.text;

        const tdKo = document.createElement("td");
        tdKo.textContent = t.meaning;

        const tdPlay = document.createElement("td");
        const btn = document.createElement("button");
        btn.textContent = "â–¶";
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          selectTrack(pos);
          playCurrent();
        });
        tdPlay.appendChild(btn);

        tr.appendChild(tdNum);
        tr.appendChild(tdEn);
        tr.appendChild(tdKo);
        tr.appendChild(tdPlay);

        tr.addEventListener("click", () => {
          selectTrack(pos);
        });

        trackTbody.appendChild(tr);
      });
      updateNowPlaying();
    }

    function selectTrack(pos) {
      currentPos = pos;
      loadCurrentTrack();
      highlightActiveRow();
      updateNowPlaying();
    }

    function highlightActiveRow() {
      [...trackTbody.querySelectorAll("tr")].forEach((tr) => {
        const p = Number(tr.dataset.pos);
        tr.classList.toggle("active", p === currentPos);
      });
    }

    function loadCurrentTrack() {
      const t = getCurrentTrack();
      audio.src = t.src;
    }

    function updateNowPlaying() {
      const t = getCurrentTrack();
      if (!t) {
        npTitle.textContent = "ì•„ì§ ì„ íƒëœ íŠ¸ë™ì´ ì—†ìŠµë‹ˆë‹¤.";
        npSubtitle.textContent = "";
        return;
      }
      npTitle.textContent = t.text;
      npSubtitle.textContent = t.meaning;
    }

    async function playCurrent() {
      const t = getCurrentTrack();
      if (!t) return;
      if (!audio.src) loadCurrentTrack();
      try {
        await audio.play();
        isPlaying = true;
        playPauseBtn.textContent = "â¸ ì¼ì‹œì •ì§€";
        playPauseBtn.classList.add("primary");
        highlightActiveRow();
      } catch (err) {
        console.error("ì¬ìƒ ì˜¤ë¥˜:", err);
      }
    }

    function pauseCurrent() {
      audio.pause();
      isPlaying = false;
      playPauseBtn.textContent = "â–¶ ì¬ìƒ";
      playPauseBtn.classList.add("primary");
    }

    function nextTrack(autoPlay = false) {
      if (order.length === 0) return;
      currentPos = (currentPos + 1) % order.length;
      loadCurrentTrack();
      highlightActiveRow();
      updateNowPlaying();
      if (autoPlay) {
        playCurrent();
      } else {
        pauseCurrent();
      }
    }

    function prevTrack(autoPlay = false) {
      if (order.length === 0) return;
      currentPos = (currentPos - 1 + order.length) % order.length;
      loadCurrentTrack();
      highlightActiveRow();
      updateNowPlaying();
      if (autoPlay) {
        playCurrent();
      } else {
        pauseCurrent();
      }
    }

    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function shuffleOrder() {
      order = shuffleArray(tracks.map((_, i) => i));
      currentPos = 0;
      loadCurrentTrack();
      renderList();
    }

    function resetOrder() {
      order = tracks.map((_, i) => i);
      currentPos = 0;
      loadCurrentTrack();
      renderList();
    }

    function showSentencePopup() {
      const t = getCurrentTrack();
      if (!t) return;
      sentenceBody.textContent = t.text;
      sentenceOverlay.classList.add("visible");
    }

    function showMeaningPopup() {
      const t = getCurrentTrack();
      if (!t) return;
      meaningBody.textContent = t.meaning;
      meaningOverlay.classList.add("visible");
    }

    function hideSentencePopup() {
      sentenceOverlay.classList.remove("visible");
    }
    function hideMeaningPopup() {
      meaningOverlay.classList.remove("visible");
    }

    // === ì´ë²¤íŠ¸ ë°”ì¸ë”© ===
    modeSelect.addEventListener("change", () => {
      currentMode = Number(modeSelect.value);
    });

    playPauseBtn.addEventListener("click", () => {
      if (!isPlaying) {
        // ì¬ìƒ
        if (!audio.src) loadCurrentTrack();
        playCurrent();
      } else {
        pauseCurrent();
      }
    });

    prevBtn.addEventListener("click", () => prevTrack(isPlaying));
    nextBtn.addEventListener("click", () => nextTrack(isPlaying));

    shuffleBtn.addEventListener("click", () => {
      shuffleOrder();
    });

    resetOrderBtn.addEventListener("click", () => {
      resetOrder();
    });

    searchInput.addEventListener("input", () => {
      renderList();
    });

    clearSearchBtn.addEventListener("click", () => {
      searchInput.value = "";
      renderList();
      searchInput.focus();
    });

    // ì˜¤ë””ì˜¤ ëë‚¬ì„ ë•Œ ëª¨ë“œë³„ ì²˜ë¦¬
    audio.addEventListener("ended", () => {
      switch (currentMode) {
        case 1: // ì¼ë°˜ ì¬ìƒ
          pauseCurrent();
          break;
        case 2: // ë°˜ë³µ ì¬ìƒ
          audio.currentTime = 0;
          playCurrent();
          break;
        case 3: // ë‹¤ìŒ ê³¡ìœ¼ë¡œ ì´ë™ë§Œ (ìë™ì¬ìƒ X)
          nextTrack(false);
          break;
        case 4: // ë‹¤ìŒ ê³¡ ìë™ì¬ìƒ
          nextTrack(true);
          break;
      }
    });

    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (ì…ë ¥ì°½ì—ì„œëŠ” ë™ì‘ X)
    document.addEventListener("keydown", (e) => {
      const tag = e.target.tagName;
      if (tag === "INPUT" || tag === "TEXTAREA") return;

      if (e.key === "s" || e.key === "S") {
        if (sentenceOverlay.classList.contains("visible")) {
          hideSentencePopup();
        } else {
          showSentencePopup();
        }
      } else if (e.key === "m" || e.key === "M") {
        if (meaningOverlay.classList.contains("visible")) {
          hideMeaningPopup();
        } else {
          showMeaningPopup();
        }
      }
    });

    // íŒì—… í„°ì¹˜/í´ë¦­ ì‹œ ë‹«ê¸°
    sentenceOverlay.addEventListener("click", hideSentencePopup);
    meaningOverlay.addEventListener("click", hideMeaningPopup);

    // ëª¨ë°”ì¼ ìŠ¤ì™€ì´í”„ (ìœ„/ì•„ë˜)
    let touchStartY = null;
    document.addEventListener("touchstart", (e) => {
      if (e.touches.length === 1) {
        touchStartY = e.touches[0].clientY;
      }
    }, { passive: true });

    document.addEventListener("touchend", (e) => {
      if (touchStartY === null) return;
      const endY = (e.changedTouches[0] || e.touches[0]).clientY;
      const dy = endY - touchStartY;

      const THRESHOLD = 40; // px
      if (Math.abs(dy) > THRESHOLD) {
        if (dy < 0) {
          // ìœ„ë¡œ ìŠ¤ì™€ì´í”„ => ë¬¸ì¥
          showSentencePopup();
        } else {
          // ì•„ë˜ë¡œ ìŠ¤ì™€ì´í”„ => ì˜ë¯¸
          showMeaningPopup();
        }
      }
      touchStartY = null;
    }, { passive: true });

    // ì´ˆê¸° ë Œë”ë§
    (function init() {
      currentMode = Number(modeSelect.value);
      loadCurrentTrack();
      renderList();
    })();
  </script>
</body>
</html>
